# PolyglotAI - トラブルシューティングガイド

このドキュメントでは、PolyglotAIアプリケーションで発生する可能性のある一般的な問題と、その解決方法を説明します。

## API関連の問題

### 1. OpenAI APIクォータ/課金エラー

**症状**:
- コンソールに `429 You exceeded your current quota` というエラーが表示される
- 文法チェック機能が動作しない

**原因**:
OpenAI APIの利用クォータを超過しているか、課金に問題があります。

**解決策**:
1. `.env.local` ファイルで `OPENAI_API_MODE=fallback` が設定されていることを確認します
2. 設定されている場合、アプリケーションは自動的にモックレスポンスにフォールバックします
3. 本番環境では、OpenAIのダッシュボードで課金状況とクォータを確認し、必要に応じて更新してください

### 2. 予期しないAPI応答形式

**症状**:
- コンソールに `Unexpected API response format: {}` というエラーが表示される
- 文法チェックの結果が表示されない

**原因**:
APIが空のオブジェクトを返すか、予期しない形式のデータを返している可能性があります。

**解決策**:
1. APIエンドポイントが常に配列形式のレスポンスを返すように修正されました
2. クライアント側で不正な形式のレスポンスを検出してフォールバックレスポンスを表示します
3. 開発環境の場合は、モックデータを使用して問題をデバッグできます

## 認証関連の問題

### 1. Clerk認証の問題

**症状**:
- ログインできない
- 認証エラーが表示される

**原因**:
Clerk APIキーの設定や、許可されたドメインの設定に問題がある可能性があります。

**解決策**:
1. `.env.local` ファイルで Clerk の API キーが正しく設定されていることを確認します
2. Clerk ダッシュボードで、アプリケーションのドメインが許可リストに追加されていることを確認します

## Google Cloud API関連の問題

### 1. Text-to-Speech APIエラー

**症状**:
- コンソールに Text-to-Speech API 関連のエラーが表示される
- 修正音声が再生されない

**原因**:
Google Cloud 認証情報の設定や API の有効化に問題がある可能性があります。

**解決策**:
1. `.env.local` ファイルで `GOOGLE_APPLICATION_CREDENTIALS_JSON` が正しく設定されていることを確認します
2. Google Cloud コンソールで Text-to-Speech API が有効化されていることを確認します
3. サービスアカウントが適切な権限を持っていることを確認します

## クライアント側の問題

### 1. 音声認識が機能しない

**症状**:
- 「録音を開始」ボタンをクリックしても、テキストが表示されない
- マイクへのアクセス許可を求めるプロンプトが表示されない

**原因**:
ブラウザがWeb Speech APIをサポートしていないか、マイクへのアクセス許可がありません。

**解決策**:
1. Chrome、Edge、Safariなどの最新のブラウザを使用していることを確認します
2. ブラウザの設定でマイクへのアクセスが許可されていることを確認します
3. HTTPSで接続していることを確認します（一部のブラウザではHTTPSが必要です）

### 2. UI表示の問題

**症状**:
- コンポーネントが正しく表示されない
- アニメーションやトランジションが動作しない

**原因**:
CSS の競合やブラウザの互換性の問題の可能性があります。

**解決策**:
1. ブラウザのキャッシュをクリアして再読み込みします
2. 最新のブラウザを使用していることを確認します
3. 開発者ツールでコンソールエラーを確認します

## 開発環境のセットアップ問題

### 1. 依存関係のインストールエラー

**症状**:
- `npm install` コマンドが失敗する
- 依存関係の競合エラーが表示される

**解決策**:
1. Node.js と npm の最新バージョンを使用していることを確認します
2. 以下のコマンドを試してください:
   ```bash
   npm install --legacy-peer-deps
   # または
   npm install --force
   ```

### 2. 環境変数が読み込まれない

**症状**:
- アプリケーションが環境変数にアクセスできない
- API キーがないというエラーが表示される

**解決策**:
1. プロジェクトのルートディレクトリに `.env.local` ファイルが存在することを確認します
2. 環境変数名が正確に一致していることを確認します
3. サーバーを再起動して環境変数が読み込まれるようにします:
   ```bash
   npm run dev
   ```

## その他の問題

問題が解決しない場合や、ここに記載されていない問題が発生した場合は、以下の手順で調査してください:

1. ブラウザの開発者ツールでコンソールエラーを確認する
2. サーバーログでエラーを確認する
3. APIエンドポイントの応答を確認する
4. 環境変数の設定を確認する

問題が継続する場合は、問題の詳細な説明とともにプロジェクトのイシュートラッカーに報告してください。 